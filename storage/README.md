# Storage

## 1. Install OMV VM

## 2. Pass hard drive to VM
- hard drive passthrough
```
lsblk

- cfdisk /dev/sda -> gpt -> New -> enter -> Write -> yes
- cfdisk /dev/sdb -> gpt -> New -> enter -> Write -> yes

root@pve-nas:~# lsblk
NAME                           MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
sda                              8:0    0   3.6T  0 disk 
└─sda1                           8:1    0   3.6T  0 part 
sdb                              8:16   0   3.6T  0 disk 
└─sdb1      
```

```
blkid
/dev/sdb1: UUID="79343378-a154-1ce2-25cd-e5d88ad53cb0" UUID_SUB="6c6616cb-b002-3dab-6470-ca9125a7b9d1" LABEL="openmediavault:0" TYPE="linux_raid_member" PARTUUID="60b8fdab-eed9-cb4a-bd83-63181569db72"
/dev/sda1: UUID="79343378-a154-1ce2-25cd-e5d88ad53cb0" UUID_SUB="c47cfa79-aa83-9517-7bfc-6f8e90a25529" LABEL="openmediavault:0" TYPE="linux_raid_member" PARTUUID="432a829b-4209-0649-8da3-31115c27ba7b"

qm set 204 -sata1 /dev/disk/by-partuuid/60b8fdab-eed9-cb4a-bd83-63181569db72
qm set 204 -sata2 /dev/disk/by-partuuid/432a829b-4209-0649-8da3-31115c27ba7b
```

- /etc/exports
```
alex@openmediavault:~$ cat /etc/exports 
# This file is auto-generated by openmediavault (https://www.openmediavault.org)
# WARNING: Do not edit this file, your changes will get lost.

# /etc/exports: the access control list for filesystems which may be exported
#               to NFS clients.  See exports(5).
/export/share 192.168.1.0/24(rw,fsid=bb2c6b75-89ce-466e-b91a-14a3384d471c,subtree_check,no_root_squash,insecure,all_squash)
/export 192.168.1.0/24(ro,fsid=0,root_squash,subtree_check)
```

- add new user on OMV
```
adduser alex
adduser alex sudo
sudo chown -R alex:alex /export/share
```
```
alex@openmediavault:/export/share$ tree -L 5
.
└── media_server
    └── data
        └── downloads
            └── qbittorrent
                ├── completed
                ├── incomplete
                └── torrents
```


- mount to client

```
sudo mount -t nfs 192.168.1.163:/export/share /mnt/share

in /etc/fstab paste this:
192.168.1.163:/export/share /mnt/share nfs defaults,_netdev 0 0

sudo mount -a
```
